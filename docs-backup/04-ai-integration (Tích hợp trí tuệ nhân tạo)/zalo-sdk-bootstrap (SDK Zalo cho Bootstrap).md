# SDK ZALO CÃ NHÃ‚N CHO BOOTSTRAP - TÃ­nh nÄƒng Ä‘á»™c quyá»n

## âš ï¸ **Cáº¢NH BÃO QUAN TRá»ŒNG - Äá»ŒC TRÆ¯á»šC KHI Sá»¬ Dá»¤NG**

### **ğŸ”´ Rá»§i ro vÃ  háº¡n cháº¿:**
- **KhÃ´ng chÃ­nh thá»©c**: SDK nÃ y dá»±a trÃªn thÆ° viá»‡n **zca-js** (khÃ´ng pháº£i API chÃ­nh thá»©c cá»§a Zalo)
- **CÃ³ thá»ƒ bá»‹ khÃ³a**: Zalo cÃ³ thá»ƒ khÃ³a tÃ i khoáº£n náº¿u phÃ¡t hiá»‡n sá»­ dá»¥ng bot hoáº·c spam
- **KhÃ´ng báº£o hÃ nh**: Zalo khÃ´ng há»— trá»£ ká»¹ thuáº­t cho SDK nÃ y
- **Thay Ä‘á»•i báº¥t ngá»**: Zalo cÃ³ thá»ƒ thay Ä‘á»•i giao thá»©c khiáº¿n SDK ngá»«ng hoáº¡t Ä‘á»™ng

### **ğŸŸ¡ Khuyáº¿n nghá»‹ sá»­ dá»¥ng:**
- **Chá»‰ dÃ¹ng cho tin nháº¯n quan trá»ng** (khÃ´ng spam)
- **Giá»›i háº¡n 100-200 tin nháº¯n/ngÃ y** Ä‘á»ƒ trÃ¡nh bá»‹ phÃ¡t hiá»‡n
- **CÃ³ káº¿ hoáº¡ch dá»± phÃ²ng** vá»›i Zalo OA chÃ­nh thá»©c
- **Test ká»¹ lÆ°á»¡ng** trÆ°á»›c khi triá»ƒn khai production

---

## ğŸ¯ **Tá»”NG QUAN SDK ZALO CÃ NHÃ‚N**

### **ğŸ’¡ Táº¡i sao cáº§n SDK Zalo cÃ¡ nhÃ¢n?**

**Váº¥n Ä‘á» vá»›i Zalo OA (Official Account):**
- **Chi phÃ­ cao**: 2-5 triá»‡u VNÄ/thÃ¡ng cho gÃ³i doanh nghiá»‡p
- **Thá»§ tá»¥c phá»©c táº¡p**: Cáº§n Ä‘Äƒng kÃ½, xÃ©t duyá»‡t, chá» phÃª duyá»‡t
- **Háº¡n cháº¿ tÃ­nh nÄƒng**: KhÃ´ng thá»ƒ gá»­i tin nháº¯n chá»§ Ä‘á»™ng cho user má»›i
- **Tá»· lá»‡ Ä‘á»c tháº¥p**: Tin nháº¯n tá»« OA thÆ°á»ng bá»‹ ignore

**Lá»£i Ã­ch SDK Zalo cÃ¡ nhÃ¢n:**
- **Chi phÃ­ 0 VNÄ**: Sá»­ dá»¥ng tÃ i khoáº£n Zalo cÃ¡ nhÃ¢n cÃ³ sáºµn
- **Tá»· lá»‡ Ä‘á»c cao**: Tin nháº¯n tá»« ngÆ°á»i tháº­t cÃ³ tá»· lá»‡ Ä‘á»c 90%+
- **KhÃ´ng cáº§n phÃª duyá»‡t**: Setup vÃ  sá»­ dá»¥ng ngay láº­p tá»©c
- **TÆ°Æ¡ng tÃ¡c tá»± nhiÃªn**: KhÃ¡ch hÃ ng cáº£m tháº¥y nhÆ° chat vá»›i ngÆ°á»i tháº­t

### **ğŸ”¤ Äá»‹nh nghÄ©a thuáº­t ngá»¯:**
- **SDK**: Software Development Kit - Bá»™ cÃ´ng cá»¥ phÃ¡t triá»ƒn pháº§n má»m
- **zca-js**: ThÆ° viá»‡n JavaScript khÃ´ng chÃ­nh thá»©c Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i Zalo
- **API**: Application Programming Interface - Giao diá»‡n láº­p trÃ¬nh á»©ng dá»¥ng
- **Webhook**: CÆ¡ cháº¿ nháº­n thÃ´ng bÃ¡o tá»± Ä‘á»™ng khi cÃ³ sá»± kiá»‡n má»›i
- **Rate Limit**: Giá»›i háº¡n tá»‘c Ä‘á»™ - sá»‘ lÆ°á»£ng request tá»‘i Ä‘a trong 1 khoáº£ng thá»i gian
- **Session**: PhiÃªn lÃ m viá»‡c - tráº¡ng thÃ¡i Ä‘Äƒng nháº­p cá»§a tÃ i khoáº£n Zalo

---

## ğŸ› ï¸ **CÃ€I Äáº¶T VÃ€ Cáº¤U HÃŒNH**

### **ğŸ“‹ YÃªu cáº§u há»‡ thá»‘ng:**
- **Node.js**: PhiÃªn báº£n 16.x trá»Ÿ lÃªn
- **NPM**: Package manager cá»§a Node.js
- **TÃ i khoáº£n Zalo**: TÃ i khoáº£n cÃ¡ nhÃ¢n Ä‘Ã£ xÃ¡c thá»±c sá»‘ Ä‘iá»‡n thoáº¡i
- **Chrome Browser**: Äá»ƒ láº¥y session cookies

### **ğŸ”§ BÆ°á»›c 1: CÃ i Ä‘áº·t thÆ° viá»‡n**
```bash
# Táº¡o thÆ° má»¥c dá»± Ã¡n
mkdir nextflow-zalo-sdk
cd nextflow-zalo-sdk

# Khá»Ÿi táº¡o project Node.js
npm init -y

# CÃ i Ä‘áº·t zca-js vÃ  dependencies
npm install zca-js
npm install puppeteer  # Äá»ƒ tá»± Ä‘á»™ng hÃ³a browser
npm install axios      # Äá»ƒ gá»i API
npm install dotenv     # Äá»ƒ quáº£n lÃ½ environment variables
```

### **ğŸ”§ BÆ°á»›c 2: Láº¥y session cookies**
```javascript
// File: get-zalo-session.js
const puppeteer = require('puppeteer');

async function getZaloSession() {
    console.log('ğŸš€ Äang khá»Ÿi Ä‘á»™ng browser Ä‘á»ƒ láº¥y Zalo session...');
    
    const browser = await puppeteer.launch({ 
        headless: false,  // Hiá»ƒn thá»‹ browser Ä‘á»ƒ user Ä‘Äƒng nháº­p
        defaultViewport: null 
    });
    
    const page = await browser.newPage();
    
    // Má»Ÿ trang Zalo Web
    await page.goto('https://chat.zalo.me');
    
    console.log('ğŸ“± Vui lÃ²ng Ä‘Äƒng nháº­p Zalo báº±ng QR code...');
    console.log('â³ Chá» 60 giÃ¢y Ä‘á»ƒ báº¡n Ä‘Äƒng nháº­p...');
    
    // Chá» user Ä‘Äƒng nháº­p
    await page.waitForTimeout(60000);
    
    // Láº¥y cookies
    const cookies = await page.cookies();
    const zaloCookies = cookies.filter(cookie => 
        cookie.domain.includes('zalo.me')
    );
    
    console.log('âœ… ÄÃ£ láº¥y Ä‘Æ°á»£c Zalo session cookies');
    console.log('ğŸ” Cookies:', JSON.stringify(zaloCookies, null, 2));
    
    await browser.close();
    return zaloCookies;
}

// Cháº¡y function
getZaloSession().catch(console.error);
```

### **ğŸ”§ BÆ°á»›c 3: Cáº¥u hÃ¬nh SDK**
```javascript
// File: zalo-config.js
require('dotenv').config();

const ZaloConfig = {
    // Session cookies tá»« bÆ°á»›c 2
    cookies: process.env.ZALO_COOKIES || '',
    
    // Giá»›i háº¡n an toÃ n
    maxMessagesPerDay: 200,        // Tá»‘i Ä‘a 200 tin/ngÃ y
    maxMessagesPerHour: 20,        // Tá»‘i Ä‘a 20 tin/giá»
    delayBetweenMessages: 5000,    // Nghá»‰ 5 giÃ¢y giá»¯a cÃ¡c tin nháº¯n
    
    // Cáº¥u hÃ¬nh retry
    maxRetries: 3,                 // Thá»­ láº¡i tá»‘i Ä‘a 3 láº§n
    retryDelay: 10000,            // Nghá»‰ 10 giÃ¢y trÆ°á»›c khi retry
    
    // Webhook Ä‘á»ƒ nháº­n tin nháº¯n
    webhookUrl: process.env.WEBHOOK_URL || 'http://localhost:3000/webhook',
    
    // Database Ä‘á»ƒ lÆ°u tráº¡ng thÃ¡i
    database: {
        host: 'localhost',
        port: 5432,
        name: 'nextflow_zalo',
        user: process.env.DB_USER,
        password: process.env.DB_PASSWORD
    }
};

module.exports = ZaloConfig;
```

### **ğŸ”§ BÆ°á»›c 4: Táº¡o Zalo SDK wrapper**
```javascript
// File: nextflow-zalo-sdk.js
const { ZaloApi } = require('zca-js');
const config = require('./zalo-config');

class NextFlowZaloSDK {
    constructor() {
        this.zalo = new ZaloApi();
        this.messageCount = 0;
        this.lastResetTime = Date.now();
        this.isInitialized = false;
    }
    
    // Khá»Ÿi táº¡o SDK
    async initialize() {
        try {
            console.log('ğŸ”„ Äang khá»Ÿi táº¡o NextFlow Zalo SDK...');
            
            // ÄÄƒng nháº­p báº±ng cookies
            await this.zalo.login(config.cookies);
            
            // Kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Äƒng nháº­p
            const profile = await this.zalo.getProfile();
            console.log('âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng:', profile.name);
            
            this.isInitialized = true;
            return true;
            
        } catch (error) {
            console.error('âŒ Lá»—i khá»Ÿi táº¡o SDK:', error.message);
            return false;
        }
    }
    
    // Gá»­i tin nháº¯n vá»›i kiá»ƒm tra rate limit
    async sendMessage(userId, message) {
        try {
            // Kiá»ƒm tra rate limit
            if (!this.checkRateLimit()) {
                throw new Error('ÄÃ£ vÆ°á»£t quÃ¡ giá»›i háº¡n tin nháº¯n cho phÃ©p');
            }
            
            // Gá»­i tin nháº¯n
            console.log(`ğŸ“¤ Äang gá»­i tin nháº¯n Ä‘áº¿n ${userId}: ${message}`);
            
            const result = await this.zalo.sendMessage({
                userId: userId,
                message: message
            });
            
            // Cáº­p nháº­t counter
            this.messageCount++;
            
            // Delay Ä‘á»ƒ trÃ¡nh spam
            await this.delay(config.delayBetweenMessages);
            
            console.log('âœ… Gá»­i tin nháº¯n thÃ nh cÃ´ng');
            return result;
            
        } catch (error) {
            console.error('âŒ Lá»—i gá»­i tin nháº¯n:', error.message);
            throw error;
        }
    }
    
    // Kiá»ƒm tra rate limit
    checkRateLimit() {
        const now = Date.now();
        const hoursPassed = (now - this.lastResetTime) / (1000 * 60 * 60);
        
        // Reset counter má»—i 24 giá»
        if (hoursPassed >= 24) {
            this.messageCount = 0;
            this.lastResetTime = now;
        }
        
        // Kiá»ƒm tra giá»›i háº¡n
        if (this.messageCount >= config.maxMessagesPerDay) {
            console.warn('âš ï¸ ÄÃ£ Ä‘áº¡t giá»›i háº¡n tin nháº¯n hÃ ng ngÃ y');
            return false;
        }
        
        return true;
    }
    
    // Delay function
    delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // Láº¥y danh sÃ¡ch báº¡n bÃ¨
    async getFriendsList() {
        try {
            const friends = await this.zalo.getFriendsList();
            console.log(`ğŸ“‹ CÃ³ ${friends.length} báº¡n bÃ¨ trong danh sÃ¡ch`);
            return friends;
        } catch (error) {
            console.error('âŒ Lá»—i láº¥y danh sÃ¡ch báº¡n bÃ¨:', error.message);
            return [];
        }
    }
    
    // Láº¯ng nghe tin nháº¯n má»›i
    async startListening() {
        try {
            console.log('ğŸ‘‚ Báº¯t Ä‘áº§u láº¯ng nghe tin nháº¯n má»›i...');
            
            this.zalo.on('message', (message) => {
                console.log('ğŸ“¨ Tin nháº¯n má»›i:', message);
                this.handleIncomingMessage(message);
            });
            
        } catch (error) {
            console.error('âŒ Lá»—i láº¯ng nghe tin nháº¯n:', error.message);
        }
    }
    
    // Xá»­ lÃ½ tin nháº¯n Ä‘áº¿n
    async handleIncomingMessage(message) {
        try {
            // Gá»­i Ä‘áº¿n NextFlow CRM Ä‘á»ƒ xá»­ lÃ½ AI
            const response = await fetch(config.webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    platform: 'zalo',
                    userId: message.fromId,
                    message: message.content,
                    timestamp: Date.now()
                })
            });
            
            const aiResponse = await response.json();
            
            // Gá»­i láº¡i cÃ¢u tráº£ lá»i tá»« AI
            if (aiResponse.reply) {
                await this.sendMessage(message.fromId, aiResponse.reply);
            }
            
        } catch (error) {
            console.error('âŒ Lá»—i xá»­ lÃ½ tin nháº¯n:', error.message);
        }
    }
}

module.exports = NextFlowZaloSDK;
```

---

## ğŸš¨ **BIá»†N PHÃP AN TOÃ€N VÃ€ GIáº¢M Rá»¦I RO**

### **ğŸ›¡ï¸ Rate Limiting (Giá»›i háº¡n tá»‘c Ä‘á»™):**
```javascript
// Cáº¥u hÃ¬nh an toÃ n
const SAFETY_LIMITS = {
    maxMessagesPerDay: 100,      // Giáº£m xuá»‘ng 100 tin/ngÃ y Ä‘á»ƒ an toÃ n hÆ¡n
    maxMessagesPerHour: 10,      // Tá»‘i Ä‘a 10 tin/giá»
    minDelayBetweenMessages: 10000, // Tá»‘i thiá»ƒu 10 giÃ¢y giá»¯a cÃ¡c tin
    maxConsecutiveMessages: 3,    // Tá»‘i Ä‘a 3 tin liÃªn tiáº¿p cho 1 ngÆ°á»i
    cooldownPeriod: 3600000      // Nghá»‰ 1 giá» sau khi Ä‘áº¡t limit
};
```

### **ğŸ” Monitoring vÃ  Alert:**
```javascript
// GiÃ¡m sÃ¡t hoáº¡t Ä‘á»™ng
class ZaloMonitor {
    constructor() {
        this.stats = {
            messagesSent: 0,
            messagesReceived: 0,
            errors: 0,
            lastActivity: null
        };
    }
    
    // Cáº£nh bÃ¡o khi cÃ³ dáº¥u hiá»‡u báº¥t thÆ°á»ng
    checkForAnomalies() {
        // QuÃ¡ nhiá»u lá»—i
        if (this.stats.errors > 10) {
            this.sendAlert('QuÃ¡ nhiá»u lá»—i, cÃ³ thá»ƒ bá»‹ Zalo phÃ¡t hiá»‡n');
        }
        
        // Gá»­i tin quÃ¡ nhanh
        const messagesPerMinute = this.calculateMessagesPerMinute();
        if (messagesPerMinute > 2) {
            this.sendAlert('Gá»­i tin nháº¯n quÃ¡ nhanh, nguy cÆ¡ bá»‹ khÃ³a');
        }
    }
    
    sendAlert(message) {
        console.error('ğŸš¨ Cáº¢NH BÃO:', message);
        // Gá»­i email hoáº·c Slack notification
    }
}
```

### **ğŸ”„ Backup Plan:**
```javascript
// Káº¿ hoáº¡ch dá»± phÃ²ng khi SDK bá»‹ lá»—i
class ZaloBackupPlan {
    constructor() {
        this.backupMethods = [
            'zalo_oa',      // Chuyá»ƒn sang Zalo OA
            'facebook',     // Chuyá»ƒn sang Facebook Messenger
            'email',        // Gá»­i email thay tháº¿
            'sms'          // Gá»­i SMS kháº©n cáº¥p
        ];
    }
    
    async executeBackup(message, recipient) {
        console.log('ğŸ”„ Thá»±c hiá»‡n backup plan...');
        
        for (const method of this.backupMethods) {
            try {
                await this.sendViaBackup(method, message, recipient);
                console.log(`âœ… Backup thÃ nh cÃ´ng qua ${method}`);
                break;
            } catch (error) {
                console.log(`âŒ Backup ${method} tháº¥t báº¡i:`, error.message);
            }
        }
    }
}
```

---

## ğŸ“Š **GIÃM SÃT VÃ€ BÃO CÃO**

### **ğŸ“ˆ Dashboard theo dÃµi:**
- **Messages sent/day**: Sá»‘ tin nháº¯n gá»­i má»—i ngÃ y
- **Success rate**: Tá»· lá»‡ gá»­i thÃ nh cÃ´ng
- **Error rate**: Tá»· lá»‡ lá»—i
- **Response time**: Thá»i gian pháº£n há»“i
- **Account health**: TÃ¬nh tráº¡ng tÃ i khoáº£n

### **ğŸ”” Cáº£nh bÃ¡o tá»± Ä‘á»™ng:**
- **Rate limit warning**: Cáº£nh bÃ¡o sáº¯p Ä‘áº¡t giá»›i háº¡n
- **Error spike**: Cáº£nh bÃ¡o tÄƒng Ä‘á»™t biáº¿n lá»—i
- **Account blocked**: Cáº£nh bÃ¡o tÃ i khoáº£n bá»‹ khÃ³a
- **Session expired**: Cáº£nh bÃ¡o session háº¿t háº¡n

---

## ğŸ’¡ **BEST PRACTICES (Thá»±c hÃ nh tá»‘t nháº¥t)**

### **âœ… NÃªn lÃ m:**
- **Test vá»›i Ã­t tin nháº¯n** trÆ°á»›c khi triá»ƒn khai
- **Sá»­ dá»¥ng nhiá»u tÃ i khoáº£n** Ä‘á»ƒ phÃ¢n tÃ¡n rá»§i ro
- **Giá»¯ ná»™i dung tin nháº¯n tá»± nhiÃªn** nhÆ° ngÆ°á»i tháº­t
- **CÃ³ káº¿ hoáº¡ch backup** vá»›i Zalo OA
- **Monitor liÃªn tá»¥c** Ä‘á»ƒ phÃ¡t hiá»‡n sá»›m váº¥n Ä‘á»

### **âŒ KhÃ´ng nÃªn lÃ m:**
- **Gá»­i tin nháº¯n spam** hoáº·c quáº£ng cÃ¡o
- **Gá»­i quÃ¡ nhiá»u tin** trong thá»i gian ngáº¯n
- **Sá»­ dá»¥ng ná»™i dung template** giá»‘ng nhau
- **Bá» qua cáº£nh bÃ¡o** tá»« há»‡ thá»‘ng
- **KhÃ´ng cÃ³ backup plan** khi SDK lá»—i

---

## ğŸ¯ **Káº¾T LUáº¬N VÃ€ KHUYáº¾N NGHá»Š**

### **ğŸŸ¢ SDK Zalo cÃ¡ nhÃ¢n phÃ¹ há»£p khi:**
- **Doanh nghiá»‡p nhá»** (dÆ°á»›i 50 khÃ¡ch hÃ ng/ngÃ y)
- **NgÃ¢n sÃ¡ch háº¡n cháº¿** (khÃ´ng Ä‘á»§ tiá»n Zalo OA)
- **Cáº§n tá»· lá»‡ Ä‘á»c cao** (tin nháº¯n quan trá»ng)
- **CÃ³ ká»¹ nÄƒng ká»¹ thuáº­t** Ä‘á»ƒ setup vÃ  monitor

### **ğŸ”´ KhÃ´ng nÃªn dÃ¹ng khi:**
- **Doanh nghiá»‡p lá»›n** (trÃªn 100 khÃ¡ch hÃ ng/ngÃ y)
- **Cáº§n Ä‘á»™ tin cáº­y cao** (khÃ´ng cháº¥p nháº­n downtime)
- **NgÃ nh nghá» nháº¡y cáº£m** (tÃ i chÃ­nh, y táº¿)
- **KhÃ´ng cÃ³ backup plan** rÃµ rÃ ng

### **âš¡ Khuyáº¿n nghá»‹ cuá»‘i cÃ¹ng:**
**Sá»­ dá»¥ng SDK Zalo cÃ¡ nhÃ¢n nhÆ° má»™t giáº£i phÃ¡p táº¡m thá»i** trong giai Ä‘oáº¡n bootstrap. Khi doanh nghiá»‡p phÃ¡t triá»ƒn vÃ  cÃ³ Ä‘á»§ ngÃ¢n sÃ¡ch, nÃªn chuyá»ƒn sang **Zalo OA chÃ­nh thá»©c** Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh á»•n Ä‘á»‹nh vÃ  tuÃ¢n thá»§.

---

**Cáº­p nháº­t láº§n cuá»‘i**: 2025-08-01  
**TÃ¡c giáº£**: NextFlow Team  
**PhiÃªn báº£n**: Bootstrap v1.0  
**âš ï¸ LÆ°u Ã½**: Sá»­ dá»¥ng cÃ³ trÃ¡ch nhiá»‡m vÃ  tuÃ¢n thá»§ Ä‘iá»u khoáº£n cá»§a Zalo
