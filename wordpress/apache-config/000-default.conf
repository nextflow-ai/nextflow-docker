# ============================================================================
# APACHE VIRTUAL HOST CONFIGURATION FOR WORDPRESS
# ============================================================================
# Tác giả: Augment Agent
# Phiên bản: 1.0
# Ngày tạo: 2025-06-16
# 
# MÔ TẢ:
# Cấu hình Apache virtual host cho WordPress để loại bỏ cảnh báo ServerName
# và tối ưu hóa performance
# ============================================================================

<VirtualHost *:80>
    # === SERVER CONFIGURATION ===
    ServerName nextflow.vn
    ServerAlias www.nextflow.vn
    ServerAlias localhost
    
    # === DOCUMENT ROOT ===
    DocumentRoot /var/www/html
    
    # === DIRECTORY PERMISSIONS ===
    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        # === WORDPRESS SPECIFIC SETTINGS ===
        # Enable .htaccess for WordPress permalinks
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteRule ^index\.php$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.php [L]
        </IfModule>
    </Directory>
    
    # === SECURITY HEADERS ===
    <IfModule mod_headers.c>
        # Prevent access to sensitive files
        <FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak)$">
            Header set X-Robots-Tag "noindex, nofollow"
            Require all denied
        </FilesMatch>
        
        # Security headers
        Header always set X-Content-Type-Options nosniff
        Header always set X-Frame-Options SAMEORIGIN
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>
    
    # === PERFORMANCE OPTIMIZATION ===
    <IfModule mod_expires.c>
        ExpiresActive On
        
        # Images
        ExpiresByType image/jpg "access plus 1 month"
        ExpiresByType image/jpeg "access plus 1 month"
        ExpiresByType image/gif "access plus 1 month"
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType image/webp "access plus 1 month"
        ExpiresByType image/svg+xml "access plus 1 month"
        
        # CSS and JavaScript
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType text/javascript "access plus 1 month"
        
        # Fonts
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
        ExpiresByType application/font-woff "access plus 1 year"
        ExpiresByType application/font-woff2 "access plus 1 year"
        
        # HTML
        ExpiresByType text/html "access plus 1 hour"
    </IfModule>
    
    # === COMPRESSION ===
    <IfModule mod_deflate.c>
        # Compress HTML, CSS, JavaScript, Text, XML and fonts
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
        AddOutputFilterByType DEFLATE application/x-font
        AddOutputFilterByType DEFLATE application/x-font-opentype
        AddOutputFilterByType DEFLATE application/x-font-otf
        AddOutputFilterByType DEFLATE application/x-font-truetype
        AddOutputFilterByType DEFLATE application/x-font-ttf
        AddOutputFilterByType DEFLATE application/x-javascript
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE font/opentype
        AddOutputFilterByType DEFLATE font/otf
        AddOutputFilterByType DEFLATE font/ttf
        AddOutputFilterByType DEFLATE image/svg+xml
        AddOutputFilterByType DEFLATE image/x-icon
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/javascript
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/xml
    </IfModule>
    
    # === LOGGING ===
    ErrorLog ${APACHE_LOG_DIR}/wordpress_error.log
    CustomLog ${APACHE_LOG_DIR}/wordpress_access.log combined
    
    # === WORDPRESS SPECIFIC RULES ===
    # Protect wp-config.php
    <Files wp-config.php>
        Require all denied
    </Files>
    
    # Protect .htaccess
    <Files .htaccess>
        Require all denied
    </Files>
    
    # Block access to wp-admin for non-logged users (except admin-ajax.php)
    <LocationMatch "^/wp-admin">
        <RequireAll>
            Require all granted
        </RequireAll>
    </LocationMatch>
    
</VirtualHost>

# ============================================================================
# GLOBAL APACHE SETTINGS
# ============================================================================

# Set ServerName globally to suppress warnings
ServerName nextflow.vn

# Security: Hide Apache version
ServerTokens Prod
ServerSignature Off

# Performance: Keep connections alive
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5
